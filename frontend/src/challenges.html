<!DOCTYPE html>
<html>

<head>
    <title>Dashboard Page</title>
    <link rel="icon" type="image/x-icon" href="./img/ai.svg" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');

        body {
            font-family: "Open Sans", sans-serif;
            color: #444444;
        }

        a {
            text-decoration: none;
            color: #d9232d;
        }

        a:hover {
            color: #e24d55;
            text-decoration: none;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: "Raleway", sans-serif;
        }

        /*--------------------------------------------------------------
      # Back to top button
      --------------------------------------------------------------*/
        .back-to-top {
            position: fixed;
            visibility: hidden;
            opacity: 0;
            right: 15px;
            bottom: 15px;
            z-index: 996;
            background: #d9232d;
            width: 40px;
            height: 40px;
            border-radius: 4px;
            transition: all 0.4s;
        }

        .back-to-top i {
            font-size: 28px;
            color: #fff;
            line-height: 0;
        }

        .back-to-top:hover {
            background: #e1444d;
            color: #fff;
        }

        .back-to-top.active {
            visibility: visible;
            opacity: 1;
        }

        #header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #0a0a0a;
            z-index: 999;
            padding: 15px 0;
            box-shadow: 0px 2px 15px rgba(0, 0, 0, 0.1);
        }

        #header .logo {
            font-size: 24px;
            margin: 0;
            font-weight: bold;
        }

        #header .logo a {
            color: #ffffff;
            text-decoration: none;
        }

        .navbar {
            padding: 0;
            width: 100%;
        }

        .navbar ul {
            list-style: none;
            display: flex;
            gap: 20px;
            padding-left: 0;
            margin: 0;
            align-items: center;
        }

        .navbar li a {
            color: #eaf4ff;
            text-decoration: none;
            font-weight: 500;
        }

        .navbar li a:hover {
            color: #70c1ff;
        }

        .logout-button {
            background-color: red;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            position: absolute;
            top: 50%;
            right: 16px;
            transform: translateY(-50%);
        }


        .navbar .getstarted,
        .navbar .getstarted:focus {
            background: #d9232d;
            padding: 8px 25px;
            margin-left: 30px;
            border-radius: 4px;
            font-weight: 400;
            color: #fff;
        }

        .navbar .getstarted:hover,
        .navbar .getstarted:focus:hover {
            color: #fff;
            background: #e1444d;
        }

        .navbar .dropdown ul {
            display: block;
            position: absolute;
            left: 14px;
            top: calc(100% + 30px);
            margin: 0;
            padding: 10px 0;
            z-index: 99;
            opacity: 0;
            visibility: hidden;
            background: #fff;
            box-shadow: 0px 0px 30px rgba(127, 137, 161, 0.25);
            transition: 0.3s;
        }

        .navbar .dropdown ul li {
            min-width: 200px;
        }

        .navbar .dropdown ul a {
            padding: 10px 20px;
            font-size: 15px;
            text-transform: none;
            font-weight: 400;
        }

        .navbar .dropdown ul a i {
            font-size: 12px;
        }

        .navbar .dropdown ul a:hover,
        .navbar .dropdown ul .active:hover,
        .navbar .dropdown ul li:hover>a {
            color: #d9232d;
        }

        .navbar .dropdown:hover>ul {
            opacity: 1;
            top: 100%;
            visibility: visible;
        }

        .navbar .dropdown .dropdown ul {
            top: 0;
            left: calc(100% - 30px);
            visibility: hidden;
        }

        .navbar .dropdown .dropdown:hover>ul {
            opacity: 1;
            top: 0;
            left: 100%;
            visibility: visible;
        }

        @media (max-width: 1366px) {
            .navbar .dropdown .dropdown ul {
                left: -90%;
            }

            .navbar .dropdown .dropdown:hover>ul {
                left: -100%;
            }
        }

        /**
      * Mobile Navigation 
      */
        .mobile-nav-toggle {
            color: #556270;
            font-size: 28px;
            cursor: pointer;
            display: none;
            line-height: 0;
            transition: 0.5s;
        }

        .mobile-nav-toggle.bi-x {
            color: #fff;
        }

        @media (max-width: 991px) {
            .mobile-nav-toggle {
                display: block;
            }

            .navbar ul {
                display: none;
            }
        }

        .navbar-mobile {
            position: fixed;
            overflow: hidden;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            background: rgba(63, 73, 83, 0.9);
            transition: 0.3s;
            z-index: 999;
        }

        .navbar-mobile .mobile-nav-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .navbar-mobile ul {
            display: block;
            position: absolute;
            top: 55px;
            right: 15px;
            bottom: 15px;
            left: 15px;
            padding: 10px 0;
            background-color: #fff;
            overflow-y: auto;
            transition: 0.3s;
        }

        .navbar-mobile a,
        .navbar-mobile a:focus {
            padding: 10px 20px;
            font-size: 15px;
            color: #556270;
        }

        .navbar-mobile a:hover,
        .navbar-mobile .active,
        .navbar-mobile li:hover>a {
            color: #d9232d;
        }

        .navbar-mobile .getstarted,
        .navbar-mobile .getstarted:focus {
            margin: 15px;
        }

        .navbar-mobile .dropdown ul {
            position: static;
            display: none;
            margin: 10px 20px;
            padding: 10px 0;
            z-index: 99;
            opacity: 1;
            visibility: visible;
            background: #fff;
            box-shadow: 0px 0px 30px rgba(127, 137, 161, 0.25);
        }

        .navbar-mobile .dropdown ul li {
            min-width: 200px;
        }

        .navbar-mobile .dropdown ul a {
            padding: 10px 20px;
        }

        .navbar-mobile .dropdown ul a i {
            font-size: 12px;
        }

        .navbar-mobile .dropdown ul a:hover,
        .navbar-mobile .dropdown ul .active:hover,
        .navbar-mobile .dropdown ul li:hover>a {
            color: #d9232d;
        }

        .navbar-mobile .dropdown>.dropdown-active {
            display: block;
        }

        .progress-bar.completed {
            background: #22c55e !important;
            /* Tailwind green-500, or pick your favorite */
        }
    </style>
    <script>

        (function (factory) {
            typeof define === 'function' && define.amd ? define(factory) :
                factory();
        })((function () {
            'use strict';

            var chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";

            function InvalidCharacterError(message) {
                this.message = message;
            }

            InvalidCharacterError.prototype = new Error();
            InvalidCharacterError.prototype.name = "InvalidCharacterError";

            function polyfill(input) {
                var str = String(input).replace(/=+$/, "");
                if (str.length % 4 == 1) {
                    throw new InvalidCharacterError(
                        "'atob' failed: The string to be decoded is not correctly encoded."
                    );
                }
                for (
                    // initialize result and counters
                    var bc = 0, bs, buffer, idx = 0, output = "";
                    // get next character
                    (buffer = str.charAt(idx++));
                    // character found in table? initialize bit storage and add its ascii value;
                    ~buffer &&
                        ((bs = bc % 4 ? bs * 64 + buffer : buffer),
                            // and if not first of each 4 characters,
                            // convert the first 8 bits to one ascii character
                            bc++ % 4) ?
                        (output += String.fromCharCode(255 & (bs >> ((-2 * bc) & 6)))) :
                        0
                ) {
                    // try to find character in table (0-63, not found => -1)
                    buffer = chars.indexOf(buffer);
                }
                return output;
            }

            var atob = (typeof window !== "undefined" &&
                window.atob &&
                window.atob.bind(window)) ||
                polyfill;

            function b64DecodeUnicode(str) {
                return decodeURIComponent(
                    atob(str).replace(/(.)/g, function (m, p) {
                        var code = p.charCodeAt(0).toString(16).toUpperCase();
                        if (code.length < 2) {
                            code = "0" + code;
                        }
                        return "%" + code;
                    })
                );
            }

            function base64_url_decode(str) {
                var output = str.replace(/-/g, "+").replace(/_/g, "/");
                switch (output.length % 4) {
                    case 0:
                        break;
                    case 2:
                        output += "==";
                        break;
                    case 3:
                        output += "=";
                        break;
                    default:
                        throw new Error("base64 string is not of the correct length");
                }

                try {
                    return b64DecodeUnicode(output);
                } catch (err) {
                    return atob(output);
                }
            }

            function InvalidTokenError(message) {
                this.message = message;
            }

            InvalidTokenError.prototype = new Error();
            InvalidTokenError.prototype.name = "InvalidTokenError";

            function jwtDecode(token, options) {
                if (typeof token !== "string") {
                    throw new InvalidTokenError("Invalid token specified: must be a string");
                }

                options = options || {};
                var pos = options.header === true ? 0 : 1;

                var part = token.split(".")[pos];
                if (typeof part !== "string") {
                    throw new InvalidTokenError("Invalid token specified: missing part #" + (pos + 1));
                }

                try {
                    var decoded = base64_url_decode(part);
                } catch (e) {
                    throw new InvalidTokenError("Invalid token specified: invalid base64 for part #" + (pos + 1) + ' (' + e.message + ')');
                }

                try {
                    return JSON.parse(decoded);
                } catch (e) {
                    throw new InvalidTokenError("Invalid token specified: invalid json for part #" + (pos + 1) + ' (' + e.message + ')');
                }
            }

            if (window) {
                if (typeof window.define == "function" && window.define.amd) {
                    window.define("jwt_decode", function () {
                        return jwtDecode;
                    });
                } else if (window) {
                    window.jwt_decode = jwtDecode;
                }
            }

        }));
        //# sourceMappingURL=jwt-decode.js.map
    </script>
    <script>
        // Retrieve the token from local storage
        const token = localStorage.getItem('token');
        // Check if the user is authenticated
        fetch('http://localhost:5000/api/auth', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'x-auth-token': token
            }
        })
            .then(response => {
                console.log(response);
                if (response.ok) {
                    // User is authenticated, proceed with the dashboard content
                    console.log('User is authenticated');



                    // Verify the token
                    try {
                        const decodedToken = jwt_decode(token);
                        console.log('Token verification successful:', decodedToken);
                    } catch (error) {
                        // Error occurred while decoding or verifying the token
                        // Redirect the user to the login page or display an error message
                        console.error('Token verification failed:', error);
                        window.location.href = 'http://localhost:3000/login.html';
                    }

                    // Here you can add your specific dashboard content and functionality
                } else {
                    // User is not authenticated, redirect to the login page or handle accordingly
                    console.log('User is not authenticated');
                    window.location.href = 'http://localhost:3000/login.html';
                }
            })
            .catch(error => {
                console.error('Error checking authentication:', error);
                // Handle error if necessary
            });
    </script>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <!-- <link rel="stylesheet" type="text/css" href="./template.css"> -->
</head>


<body style="height: 100%; background-color: #1a1a1a;">
    <header id="header" class="fixed-top d-flex align-items-center bg-dark">
        <div class="container d-flex align-items-center">
            <h1 class="logo me-auto"><a href="index.html" class="text-light">POSE FIT</a></h1>
            <nav id="navbar" class="navbar">
                <ul class="d-flex list-unstyled mb-0">
                    <li><a href="dashboard.html">Exercises</a></li>
                    <li><a href="challenges.html">Challenges</a></li>
                    <li><a href="user_activity.html"> Activities</a></li>
                    <li><a href="workoutplans.html">Leaderboard</a></li>
                    <li><a href="bmi.html">Diet Plan Generator</a></li>
                    <li><a href="user_activity_graph.html"> Activity Graphs</a></li>
                    <button id="logoutButton" class="logout-button">Logout</button>
                </ul>
            </nav>
        </div>
    </header>

    <!--------------------------------------------------------------
  # Main Exercise Section.
  -------------------------------------------------------------->

    <!-- CHALLENGES SECTION (inserted above exercise cards) -->
    <div class="container" style="margin-top: 120px; margin-bottom: 40px;">
        <div class="text-center mb-5">
            <h2 style="color: #2563eb; font-weight: bold;">🏆 Interactive Fitness Challenges</h2>
            <p style="color: #3b82f6;">Pick a challenge, start your camera, and see how fast you can complete it!</p>
        </div>
        <div class="row" id="challenge-list">
            <!-- Challenge cards will be injected here -->
        </div>
        <!-- Challenge Complete Popup -->
        <div id="challengeCompletePopup"
            style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(37,99,235,0.7); z-index:9999; align-items:center; justify-content:center;">
            <div
                style="background:white; padding:2rem 3rem; border-radius:1rem; text-align:center; max-width:90vw; border: 3px solid #2563eb;">
                <h2 style="color:#2563eb;">🎉 Challenge Completed!</h2>
                <p id="popup-message" style="font-size:1.2rem; color:#2563eb;"></p>
                <div class="popup-time" id="popup-time" style="font-size:1.1rem; color:#1e40af;"></div>
                <button id="closeChallengePopup"
                    style="margin-top:1rem; padding:0.5rem 1.5rem; background:#2563eb; color:white; border:none; border-radius:0.5rem; font-size:1.1rem;">OK</button>
            </div>
        </div>
    </div>
    <script>
        // List of challenges (slug, display, target, id, description)
        const CHALLENGES = [
            { slug: 'push-up', display: 'Pushup-low', target: 20, id: 'push-up-20', desc: 'Complete 20 push-ups with proper form.' },
            { slug: 'push-up', display: 'Pushup-medium', target: 50, id: 'push-up-50', desc: 'Complete 50 push-ups with proper form.' },
            { slug: 'push-up', display: 'Pushup-high', target: 100, id: 'push-up-100', desc: 'Complete 100 push-ups with proper form.' },
            { slug: 'squat', display: 'Squat-low', target: 20, id: 'squat-20', desc: 'Complete 20 squats with proper form.' },
            { slug: 'squat', display: 'Squat-medium', target: 50, id: 'squat-50', desc: 'Complete 50 squats with proper form.' },
            { slug: 'squat', display: 'Squat-high', target: 100, id: 'squat-100', desc: 'Complete 100 squats with proper form.' },
            { slug: 'jumping-jacks', display: 'Jumping Jacks-low', target: 20, id: 'jumping-jacks-20', desc: 'Complete 20 jumping jacks.' },
            { slug: 'jumping-jacks', display: 'Jumping Jacks-medium', target: 50, id: 'jumping-jacks-50', desc: 'Complete 50 jumping jacks.' },
            { slug: 'jumping-jacks', display: 'Jumping Jacks-high', target: 100, id: 'jumping-jacks-100', desc: 'Complete 100 jumping jacks.' },
            { slug: 'curls', display: 'Dumbbell High Curl-low', target: 20, id: 'curls-20', desc: 'Complete 20 dumbbell high curls.' },
            { slug: 'curls', display: 'Dumbbell High Curl-medium', target: 50, id: 'curls-50', desc: 'Complete 50 dumbbell high curls.' },
            { slug: 'curls', display: 'Dumbbell High Curl-high', target: 100, id: 'curls-100', desc: 'Complete 100 dumbbell high curls.' },
            { slug: 'lunges', display: 'Lunges-low', target: 20, id: 'lunges-20', desc: 'Complete 20 lunges (10 each leg).' },
            { slug: 'lunges', display: 'Lunges-medium', target: 50, id: 'lunges-50', desc: 'Complete 50 lunges (25 each leg).' },
            { slug: 'lunges', display: 'Lunges-high', target: 100, id: 'lunges-100', desc: 'Complete 100 lunges (50 each leg).' },
        ];
        // Helper to get all challenge progress for the logged-in user from backend
        async function getAllChallengeProgress() {
            const userId = localStorage.getItem('uid');
            if (!userId) return {};
            try {
                const res = await fetch('http://localhost:5000/challenge/getAllCompletions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId })
                });
                if (!res.ok) return {};
                const completions = await res.json();
                const progress = {};
                completions.forEach(c => {
                    const chal = CHALLENGES.find(ch => ch.display === c.challengeName && ch.target === c.target);
                    if (chal) {
                        // If timeTaken exists, treat as completed and set count to target
                        const isCompleted = !!c.timeTaken;
                        progress[chal.id] = {
                            currentCount: isCompleted ? chal.target : (typeof c.repsCompleted === 'number' ? c.repsCompleted : 0),
                            completed: isCompleted,
                            time: c.timeTaken
                        };
                    }
                });
                return progress;
            } catch (e) {
                return {};
            }
        }
        // Render challenge cards (now async)
        async function renderChallenges() {
            const row = document.getElementById('challenge-list');
            const allProgress = await getAllChallengeProgress();
            // Fetch latest completions for all challenges for the current user
            const latestTimes = {};
            for (const chal of CHALLENGES) {
                const latest = await fetchLatestChallengeCompletion(chal.display, chal.target);
                if (latest && latest.timeTaken) {
                    latestTimes[chal.id] = latest.timeTaken;
                }
            }
            row.innerHTML = CHALLENGES.map(chal => {
                // Check if this challenge is completed
                let completedMsg = '';
                const chalProgress = allProgress[chal.id];
                let timeStr = '';
                if (latestTimes[chal.id]) {
                    timeStr = `<div style=\"color:green;font-weight:bold;margin-bottom:4px;\">Your best time: <span>${formatTime(latestTimes[chal.id])}</span></div>`;
                }
                if (chalProgress && chalProgress.completed && chalProgress.currentCount >= chal.target) {
                    completedMsg = `<div style=\"color:green;font-weight:bold;margin-bottom:4px;\">You have completed this challenge!${timeStr}</div>`;
                } else if (timeStr) {
                    completedMsg = timeStr;
                }
                return `
          <div class="col-md-6 col-lg-4 mb-4 d-flex">
            <div class="card shadow w-100" style="border:2px solid #2563eb; border-radius:16px;">
              <div class="card-body d-flex flex-column justify-content-between">
                <h4 class="card-title" style="color:#2563eb; font-weight:bold;">${chal.display} Challenge</h4>
                ${completedMsg}
                <p class="card-text" style="color:#1e40af;">${chal.desc}</p>
                <div class="mb-2">
                  <span style="color:#3b82f6; font-weight:600;">Target: ${chal.target} reps</span>
                </div>
                <div class="progress mb-2" style="height:10px;">
                  <div class="progress-bar${(chalProgress && chalProgress.completed) ? ' completed' : ''}" 
                       id="${chal.id}-progress" 
                       role="progressbar" 
                       style="width:${(chalProgress && chalProgress.completed) ? '100' : (chalProgress ? Math.min((chalProgress.currentCount / chal.target) * 100, 100) : 0)}%; background:${(chalProgress && chalProgress.completed) ? '#22c55e' : '#2563eb'};" 
                       aria-valuenow="${(chalProgress && chalProgress.completed) ? chal.target : (chalProgress ? chalProgress.currentCount : 0)}" 
                       aria-valuemin="0" 
                       aria-valuemax="${chal.target}">
          </div>
        </div>
        <small style="color:#2563eb;">Progress: <span id="${chal.id}-current">${(chalProgress && chalProgress.completed) ? chal.target : (chalProgress ? chalProgress.currentCount : 0)}</span>/${chal.target}</small>
        <button class="btn btn-primary mt-3" style="background:#2563eb; border:none;" onclick="updateWorkout('${chal.id}')">Start Challenge</button>
        
      </div>
    </div>
  </div>
`;
            }).join('');
        }
        // Remove startChallengeFromList, use updateWorkout for challenge start
        // function resetChallenge(challengeId) {
        //     const progressElement = document.getElementById(challengeId + '-progress');
        //     const currentElement = document.getElementById(challengeId + '-current');
        //     if (progressElement && currentElement) {
        //         progressElement.style.width = '0%';
        //         currentElement.textContent = '0';
        //     }
        //     let currentChallenge = JSON.parse(localStorage.getItem('currentChallenge') || 'null');
        //     if (currentChallenge && currentChallenge.challengeId === challengeId) {
        //         localStorage.removeItem('currentChallenge');
        //         localStorage.removeItem('challengeCompleted');
        //         localStorage.removeItem('challengeTime');
        //     }
        //     // Call backend to reset progress for this challenge
        //     const chal = CHALLENGES.find(c => c.id === challengeId);
        //     const userId = localStorage.getItem('uid');
        //     if (chal && userId) {
        //         fetch('http://localhost:5000/challenge/resetCompletion', {
        //             method: 'POST',
        //             headers: { 'Content-Type': 'application/json' },
        //             body: JSON.stringify({ userId, challengeName: chal.display, target: chal.target })
        //         }).then(() => {
        //             renderChallenges();
        //             loadChallengeProgress();
        //         });
        //     } else {
        //         renderChallenges();
        //         loadChallengeProgress();
        //     }
        // }
        // // Update loadChallengeProgress to use backend data
        async function loadChallengeProgress() {
            const allProgress = await getAllChallengeProgress();
            CHALLENGES.forEach(chal => {
                const progressElement = document.getElementById(chal.id + '-progress');
                const currentElement = document.getElementById(chal.id + '-current');
                let count = 0;
                if (allProgress[chal.id]) {
                    // If completed, show the target as the count
                    count = allProgress[chal.id].completed ? chal.target : (allProgress[chal.id].currentCount || 0);
                }
                if (progressElement && currentElement) {
                    const progress = (count / chal.target) * 100;
                    progressElement.style.width = progress + '%';
                    currentElement.textContent = count;

                    // Add or remove the 'completed' class based on completion
                    if (allProgress[chal.id] && allProgress[chal.id].completed) {
                        progressElement.classList.add('completed');
                    } else {
                        progressElement.classList.remove('completed');
                    }
                }
            });
            // Show popup if just completed a challenge (localStorage logic can remain for now)
            const justCompleted = localStorage.getItem('justCompletedChallenge');
            if (justCompleted) {
                const chal = CHALLENGES.find(c => c.id === justCompleted);
                if (chal) {
                    // Fetch the latest completion from backend and show popup with correct time
                    fetchLatestChallengeCompletion(chal.display, chal.target).then(latest => {
                        if (latest) {
                            showChallengeCompletePopup(chal, latest.timeTaken);
                        } else {
                            showChallengeCompletePopup(chal, null);
                        }
                    });
                } else {
                    showChallengeCompletePopup({ display: justCompleted }, null);
                }
                localStorage.removeItem('justCompletedChallenge');
            }
        }
        function showChallengeCompletePopup(challenge, time) {
            const popup = document.getElementById('challengeCompletePopup');
            const msg = document.getElementById('popup-message');
            const timeBox = document.getElementById('popup-time');
            msg.textContent = `You are completed!`;
            if (time) {
                timeBox.textContent = `Time taken: ${formatTime(time)}`;
            } else {
                timeBox.textContent = '';
            }
            // Remove leaderboard display: do not fetch or show leaderboard
            let leaderboardDiv = document.getElementById('popup-leaderboard');
            if (leaderboardDiv) {
                leaderboardDiv.remove();
            }
            popup.style.display = 'flex';
            document.getElementById('closeChallengePopup').onclick = function () {
                popup.style.display = 'none';
            };
        }
        function formatTime(seconds) {
            seconds = parseInt(seconds, 10);
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
        }
        // On DOMContentLoaded, use the new async render and load
        document.addEventListener('DOMContentLoaded', function () {
            renderChallenges();
            loadChallengeProgress();
        });
        window.addEventListener('storage', function (e) {
            if (e.key === 'challengeCompleted' || e.key === 'challengeTime' || e.key === 'challengeProgress') {
                loadChallengeProgress();
            }
        });
    </script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        function updateWorkout(challengeId) {
            // Find the challenge object by id
            const chal = CHALLENGES.find(c => c.id === challengeId);
            if (chal) {
                // Store challenge info in localStorage
                localStorage.setItem('currentChallenge', JSON.stringify({
                    challengeId: chal.id,
                    slug: chal.slug,
                    target: chal.target,
                    display: chal.display,
                    currentCount: 0 // will be updated in challenge-run.js
                }));
            }
            localStorage.setItem('DBWOSettings', JSON.stringify({
                ...JSON.parse(localStorage.getItem('DBWOSettings')),
                currWorkout: chal ? chal.slug : ''
            }));
            location.href = 'http://localhost:3000/challenge-run.html';
        }
    </script>
    <script>
        // Logout button click event
        document.getElementById('logoutButton').addEventListener('click', (e) => {
            e.preventDefault();
            // Remove the token from localStorage
            localStorage.removeItem('token');

            // Redirect to the login page or perform any other necessary actions
            window.location.href = '/';
        });
    </script>

    <script>
        async function fetchLatestChallengeCompletion(challengeName, target) {
            const userId = localStorage.getItem('uid');
            if (!userId) return null;
            try {
                const res = await fetch('http://localhost:5000/challenge/getAllCompletions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId })
                });
                if (!res.ok) return null;
                const completions = await res.json();
                // Find the latest completion for this challenge and target
                const filtered = completions
                    .filter(c => c.challengeName === challengeName && c.target === target)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                return filtered[0] || null;
            } catch (e) {
                return null;
            }
        }
    </script>


</body>

</html>